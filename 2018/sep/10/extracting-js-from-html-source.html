<!DOCTYPE html>
<html lang="en">
  
<!-- Mirrored from blog.nut/2018/sep/10/extracting-js-from-html-source by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 15 Oct 2020 15:05:24 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <script>var _gaq = _gaq || []; _gaq.push(['_setDomainName', location.hostname]);</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="initial-scale=1">
    <title>
Extracting JS from HTML source -       Félix “passcod” Saparelli - Blog
    </title>
    <link rel="alternate" href="../../../feed.xml">
    <link rel="stylesheet" href="../../../assets/1.3.3/style.css">
  </head>

  <body>
    <div class="raised">
      <header class="root">
        <h1><a href="../../../index.html">Félix Saparelli</a></h1>
        <p class="sidelong"><a rel="me" href="https://passcod.name/">(about me)</a></p>
        <p class="subtitle">a.k.a. passcod<a href="https://blog.passcod.name/trademark">™</a></p>
      </header>
      <main>
        <article class="h-entry e-content">
  <header>
    <h1 class="p-name">Extracting JS from HTML source</h1>

  
    <p>Posted on <a href="extracting-js-from-html-source.html" class="u-url"><date datetime="2018-09-10T05:13:47.000Z" title="2018-09-10T05:13:47.000Z" class="dt-published">Sep 10 ‘18</date></a></p>
  

  
    <p>This
      
      <a href="../../../tag/snippet.html" rel="main tag" class="p-category">snippet</a>
      is also tagged as
        <a href="../../../tag/html.html" rel="tag" class="p-category">html</a>, <a href="../../../tag/js.html" rel="tag" class="p-category">js</a>, <a href="../../../tag/ruby.html" rel="tag" class="p-category">ruby</a>
      
    </p>
  

  
  </header>

  <p>I decided last month I would make an effort to post more technical articles,
single-thing blurbs to show neat things I’ve done, or just tiny scripts,
workspace improvements, that kind of thing.</p>
<p>Today’s is a small ruby script I coded in a few minutes to extract all the JS
from a source tree of mixed files (like a PHP codebase). It outputs into a
folder; the idea is then to use ripgrep to look through it. In our case, we
wanted to find some ES2017 features we shouldn’t have used (as they’re not
supported in our browser range).</p>
<pre><code class="language-ruby">require ‘nokogiri’

ARGV.each do |file|
  begin
    puts “Processing #{file}…”

    if file =~ /\.js$/
      jspath = “alljs/#{file}”
      `mkdir -p #{jspath}; rmdir #{jspath}`
      File.write(jspath, File.read(file))
      next
    end

    index = 0
    doc = File.open(file) { |f| Nokogiri::HTML(f) }
    doc.css(‘script’).each do |scr|
      next unless !scr[‘type’] || scr[‘type’].empty? || scr[‘type’] =~ /javascript/
      jspath = “alljs/#{file}.#{index}.js”
      `mkdir -p #{jspath}; rmdir #{jspath}`
      File.write(jspath, scr.content)
      index += 1
    end
  end
end
</code></pre>
<p>Usage is like this:</p>
<pre><code class="language-bash">tree -if application client | rg ‘.(tpl|html|php|js)$’ | xargs ruby extract-js.rb
</code></pre>
<p>Some details and notes:</p>
<ul>
<li><code>tree -f</code> prints the full relative path.</li>
<li><code>tree -i</code> doesn’t print the ascii art tree.</li>
<li>Passing folders to <code>tree</code> only looks into those folders but bases the paths
on the current dir.</li>
<li><code>mkdir -p #{path}; rmdir #{path}</code> is an awful hack but it works! It builds
the tree to that point minus the file you want to write. I couldn’t be
bothered figuring out how to do path parsing and splitting correctly for
such a quick script.</li>
<li>Several lines are just copied wholesale (for the JS/HTML switch): this is
entirely fine. <a href="https://www.sandimetz.com/">Sandi Metz</a> has a cool phrase for
it, but basically: don’t fear simply copying things around. DRY is for when
you want to extract and abstract. It’s one of the last steps. And I add:
sometimes it’s not necessary at all.</li>
</ul>


  <footer>
  
    <p>Travel back to the <a rel="prev" href="monthly-update.html" title="Medical I got some dental surgery done at long last early this month, and the recovery was somewhat longer than I’d thought, which didn’t help with projects. I’m all good now, though! (And two teeth lighter.) Watchexec…">previous</a> article</p>
  

  
    <p>Skip forward to the <a rel="next" href="../12/smile.html" title="You think you are out there exploring the limits. The limits of the possible, / the limits of the feasible, / the limits of the thinkable. The limits of the imaginable. And we smile, when we see you, children that you…">next</a> one</p>
  

    <p>Praise, thoughts, criticism? <a href="https://twitter.com/passcod">@passcod</a> or <a href="mailto:felix@passcod.name">felix@passcod.name</a></p>

  
  </footer>
</article>

      </main>
    </div>
    <footer class="root">
      <p>
        <a rel="alternate" href="../../../feed.xml">Feed</a>.
        © 2008–2020.
        Content licensed under <a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a>.
      </p>
    </footer>

    <button class="flip" title="Turn the lights off.">day</button>
    <script async src="../../../assets/1.3.3/circadian.js"></script>
    <script async src="../../../assets/1.3.3/prism.js"></script>

    <link rel="stylesheet" href="../../../assets/1.3.3/fonts.css">
    <link rel="stylesheet" href="../../../assets/1.3.3/prism.css">
  </body>

<!-- Mirrored from blog.nut/2018/sep/10/extracting-js-from-html-source by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 15 Oct 2020 15:05:24 GMT -->
</html>
